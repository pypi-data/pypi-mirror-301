import{d as j,i as V,a as h,c as y,o as k,k as Q,W as ve,b as L,e as p,t as D,X as _e,r as B,Y as M,J as z,Z as A,L as ee,_ as K,$ as he,H as te,w as G,v as J,x as ne,y as ge,f as ye,a0 as be,F as Ce,m as Se,n as oe,p as se,h as ae,a1 as we,l as Ie,U as Ee,a2 as Me,a3 as Pe,a4 as $e,A as Z}from"./index-C2MNJn6s.js";const Te=10,ke=j({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(i){const n=V(h.core),m=i,d=(b,l)=>{const w=b.map(c=>n.getComponentDefinition(c)).map(c=>c==null?void 0:c.name);return`${w.slice(0,-1).join(", ")} ${w.length>1?l:""} ${w.at(-1)}`},s=y(()=>{const b=n.getContainableTypes(m.componentId);let l;return b.length<=Te&&(l=`You can add ${d(b,"and")} components`),l});return(b,l)=>(k(),Q(ve,{class:"ChildlessPlaceholder","component-id":i.componentId,message:s.value},null,8,["component-id","message"]))}}),Ae={class:"RenderError"},De={class:"title"},Be={class:"message"},Ve=j({__name:"RenderError",props:{componentType:{},message:{}},setup(i){const n=i;return(m,d)=>(k(),L("div",Ae,[p("div",De,[p("h2",null,"Error rendering "+D(n.componentType),1)]),p("div",Be,D(n.message),1)]))}});function xe(i){return i.map(n=>`${n.componentId}:${n.instanceNumber}`).join(",")}function st(i){return i?i.split(",").map(n=>{const[m,d]=n.split(":");return{componentId:m,instanceNumber:Number(d)}}):[]}const Fe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{validator:()=>!0,required:!0}},setup(i){const n=V(h.core),m=V(h.builderManager),d=i.componentId,s=y(()=>n.getComponentById(d)),b=_e(s.value.type),l=i.instancePath,P=i.instanceData,{getEvaluatedFields:w,isComponentVisible:T}=ee(n),c=w(l),E=y(()=>n.getComponents(d,{sortedByPosition:!0})),I=y(()=>!!m&&m.getMode()!="preview"),O=y(()=>I.value&&!s.value.isCodeManaged&&s.value.type!=="root"&&s.value.type!=="workflows_root"),W=(o,r)=>(o?n.getContainableTypes(o):["root","workflows_root"]).includes(r),x=B(!1),e=y(()=>n.getUserFunctions()),t=()=>{if(!(E.value.length>0))return A(ke,{componentId:s.value.id})},a=(o,r=0,f={})=>A(re,{componentId:o,key:`${o}:${r}`,instancePath:[...l,{componentId:o,instanceNumber:r}],instanceData:[...P,B(null)],...f}),_=o=>r=>{if(!W(d,r.type)&&o==="default")return!0;const u=n.getComponentDefinition(r.type).slot??"default";return u==="*"||u===o},$=(o=0,r="default",f=()=>!0,u=!1)=>{const v=g=>!I.value||u?[]:[A("div",{"data-writer-slot-of-id":d,"data-writer-position":g})],C=E.value.filter(_(r)).filter(f),S=C.filter(g=>!g.isCodeManaged).map(g=>a(g.id,o,{contextSlot:r})),R=C.filter(g=>g.isCodeManaged).map(g=>a(g.id,o,{contextSlot:r}));return[...v(0),...S.map((g,N)=>[g,v(N+1)]).flat(),...R]},F=xe(l);M(h.evaluatedFields,c),M(h.componentId,d),M(h.isBeingEdited,I),M(h.isDisabled,x),M(h.instancePath,l),M(h.instanceData,P),M(h.renderProxiedComponent,a),M(h.getChildrenVNodes,$),M(h.flattenedInstancePath,F);const ie={"data-writer-id":d,"data-writer-instance-path":F},q=B(!1);z(()=>(m==null?void 0:m.getSelectedId())==d,o=>{q.value=o}),z(()=>c,()=>{q.value=!1},{deep:!0});const U=y(()=>E.value.length==0),le=y(()=>T(d,l)),ce=(o,r)=>{if(!o.startsWith("$goToPage_")&&!r)return u=>{let v=!1;e.value.some(C=>C.name==o&&C.args.includes("payload"))&&(v=!0),o.startsWith("$runWorkflow_")&&(v=!0),n.forwardEvent(u,l,v)};if(o.startsWith("$goToPage_")){const u=o.substring(10);return v=>n.setActivePageFromKey(u)}return null},de=y(()=>{const o={},r=Object.keys(s.value.handlers??{}),f=s.value.binding?[s.value.binding.eventType]:[];return Array.from(new Set([...r,...f])).forEach(v=>{var R;const C=`on${v.charAt(0).toUpperCase()}${v.slice(1)}`,S=v===((R=s.value.binding)==null?void 0:R.eventType);o[C]=g=>{var X,Y;S&&n.forwardEvent(g,l,!0);const N=(X=s.value.handlers)==null?void 0:X[v];N&&((Y=ce(N,S))==null||Y(g))}}),o}),ue=y(()=>{var f;const o=(f=n.getComponentDefinition(s.value.type))==null?void 0:f.fields;if(!o)return;const r={};return Object.keys(o).forEach(u=>{o[u].applyStyleVariable&&c[u]&&(r[`--${u}`]=c[u].value)}),r}),pe=y(()=>{var C;const o="cssClasses",r=(C=n.getComponentDefinition(s.value.type))==null?void 0:C.fields;if(!r||!r[o]||!c[o])return;const f=c[o].value,u=f==null?void 0:f.split(" ").map(S=>S.trim()),v={};return u.forEach(S=>{v[S]=!0}),v}),me=function(){return{class:{[`wf-type-${s.value.type}`]:!0,component:!0,childless:U.value,selected:q.value,disabled:x.value,beingEdited:I.value,...pe.value},style:{...ue.value,...le.value?{}:{display:"none"}},...ie,...x.value?[]:de.value,draggable:O.value}},fe=(o,r)=>I.value?A(Ve,{...o,componentType:s.value.type,message:r}):A("div");return()=>{const o=I.value?t():void 0,r=({instanceNumber:u=0,slotName:v="default",componentFilter:C=()=>!0,positionlessSlot:S=!1})=>U.value?S?void 0:o:$(u,v,C,S),f={...me()};return W(s.value.parentId,s.value.type)?A(b,f,{default:r}):fe(f,"Parent is not suitable for this component")}}},re=K(Fe,[["__scopeId","data-v-0f6d6cf3"]]),H=i=>(se("data-v-b2157300"),i=i(),ae(),i),Re=H(()=>p("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),Le={class:"counter"},We=H(()=>p("div",{class:"balloonFlash"},null,-1)),Ne={class:"main"},je={class:"clearContainer"},He=H(()=>p("i",{class:"material-symbols-outlined"}," clear_all ",-1)),Oe=H(()=>p("i",{class:"material-symbols-outlined"}," exclamation ",-1)),qe=[Oe],ze={class:"content"},Ke={class:"title"},Ue={class:"time"},Xe={class:"message"},Ye=100,Ge=j({__name:"RendererNotifications",setup(i){const n=V(h.core),m=B(!1),d=B(null),s=he([]),b=w=>{const{type:T,title:c,message:E,code:I}=w;s.unshift({type:T,title:c,message:E,code:I,timestampReceived:new Date}),s.splice(Ye),d.value.classList.remove("alert"),d.value.offsetWidth,d.value.classList.add("alert")};te(()=>{n.addMailSubscription("notification",b)});const l=()=>{s.length!=0&&(m.value=!m.value)},P=()=>{s.splice(0),m.value=!1};return(w,T)=>G((k(),L("div",{class:"RendererNotifications colorTransformer",onClick:l},[p("div",{ref_key:"balloon",ref:d,class:"balloon",title:"Toggle notifications"},[Re,p("div",Le,D(s.length),1)],512),We,G(p("div",Ne,[p("div",je,[ne(be,{onClick:P},{default:ge(()=>[He,ye(" Clear all ")]),_:1})]),(k(!0),L(Ce,null,Se(s,(c,E)=>(k(),L("div",{key:E,class:"notification"},[p("div",{class:oe(["icon",c.type])},qe,2),p("div",ze,[p("header",null,[p("strong",Ke,D(c.title),1),p("span",Ue,D(c.timestampReceived.toLocaleTimeString()),1)]),p("div",Xe,D(c.message),1)])]))),128))],512),[[J,m.value]])],512)),[[J,s.length>0]])}}),Je=K(Ge,[["__scopeId","data-v-b2157300"]]),Ze=i=>(se("data-v-8b9f242c"),i=i(),ae(),i),Qe=Ze(()=>p("div",{class:"loadingBar"},null,-1)),et={class:"rootComponentArea"},tt=j({__name:"ComponentRenderer",setup(i){const n=V(h.core),m=V(h.builderManager),d=ee(n),s={},b=y(()=>m&&m.getMode()=="workflows"?"workflows_root":"root"),l=d.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),P=y(()=>{var e,t,a,_,$,F;return{"--accentColor":(e=l.accentColor)==null?void 0:e.value,"--emptinessColor":(t=l.emptinessColor)==null?void 0:t.value,"--containerBackgroundColor":(a=l.parentIdBackgroundColor)==null?void 0:a.value,"--primaryTextColor":(_=l.primaryTextColor)==null?void 0:_.value,"--secondaryTextColor":($=l.secondaryTextColor)==null?void 0:$.value,"--separatorColor":(F=l.separatorColor)==null?void 0:F.value}}),w=y(()=>n.getFrontendMessageMap().size>0);z(()=>{var e;return(e=l.appName)==null?void 0:e.value},e=>{T(e)},{immediate:!0});function T(e){const t=n.getMode();let a;e&&t=="edit"?a=`${e} | Writer Framework | Builder`:!e&&t=="edit"?a="Writer Framework | Builder":e&&t=="run"?a=`${e}`:!e&&t=="run"&&(a="Writer Framework App"),document.title=a}async function c(e,t){const a=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);a==null||a.remove();const _=document.createElement("link");_.dataset.writerStylesheetKey=e,_.setAttribute("href",t),_.setAttribute("rel","stylesheet"),document.head.appendChild(_)}async function E(e,t){const a=document.querySelector(`[data-writer-script-key="${e}"]`);a==null||a.remove();const _=document.createElement("script");_.dataset.writerScriptKey=e,_.src=t,_.setAttribute("rel","modulepreload"),document.head.appendChild(_)}async function I(e,t){s[e]=t,await Z(()=>import(t),[],import.meta.url)}async function O(e,t,a){const _=s[e],$=await Z(()=>import(_),[],import.meta.url);if(!$){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}$[t](...a)}function W(){n.addMailSubscription("fileDownload",e=>{const t=document.createElement("a");t.href=e.data,t.download=e.fileName,t.click()}),n.addMailSubscription("openUrl",e=>{const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.click()}),n.addMailSubscription("pageChange",e=>{Me(e)}),n.addMailSubscription("routeVarsChange",e=>{Pe(e)}),n.addMailSubscription("importStylesheet",({stylesheetKey:e,path:t})=>{c(e,t)}),n.addMailSubscription("importScript",({scriptKey:e,path:t})=>{E(e,t)}),n.addMailSubscription("importModule",({moduleKey:e,specifier:t})=>{I(e,t)}),n.addMailSubscription("functionCall",({moduleKey:e,functionName:t,args:a})=>{O(e,t,a)})}function x(){const e=$e(),t=new CustomEvent("wf-app-open",{detail:{payload:e}}),a={componentId:"root",instanceNumber:0};n.forwardEvent(t,[a],!0)}return we(()=>{W()}),te(()=>{x()}),(e,t)=>(k(),L("main",{class:oe(["ComponentRenderer",{loadingActive:w.value}]),tabindex:"-1",style:Ee(P.value)},[ne(Je,{class:"notifications"}),Qe,p("div",et,[(k(),Q(re,{key:b.value,"component-id":b.value,"instance-path":[{componentId:b.value,instanceNumber:0}],"instance-data":[B(null)]},null,8,["component-id","instance-path","instance-data"])),Ie(e.$slots,"default",{},void 0,!0)])],6))}}),nt=K(tt,[["__scopeId","data-v-8b9f242c"]]),at=Object.freeze(Object.defineProperty({__proto__:null,default:nt},Symbol.toStringTag,{value:"Module"}));export{nt as C,at as a,st as p};
