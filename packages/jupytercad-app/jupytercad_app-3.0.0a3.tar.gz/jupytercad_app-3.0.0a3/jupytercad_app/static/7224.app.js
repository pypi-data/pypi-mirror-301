"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7224],{27224:(e,t,s)=>{s.r(t),s.d(t,{YBaseCell:()=>c,YCodeCell:()=>g,YDocument:()=>d,YFile:()=>r,YMarkdownCell:()=>m,YNotebook:()=>_,YRawCell:()=>y,convertYMapEventToMapChange:()=>b,createMutex:()=>C,createStandaloneCell:()=>u});var a=s(68211),n=s(30427),o=s(97784),i=s(58919);class d{constructor(){this.ydoc=new i.Doc,this.ystate=this.ydoc.getMap("state"),this.undoManager=new i.UndoManager([],{trackedOrigins:new Set([this]),doc:this.ydoc}),this.awareness=new o.ww(this.ydoc),this.onStateChanged=e=>{const t=new Array;e.keysChanged.forEach((s=>{const a=e.changes.keys.get(s);a&&t.push({name:s,oldValue:a.oldValue,newValue:this.ystate.get(s)})})),this._changed.emit({stateChange:t})},this._changed=new n.Signal(this),this._isDisposed=!1,this.ystate.observe(this.onStateChanged)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get state(){return a.JSONExt.deepCopy(this.ystate.toJSON())}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}dispose(){this._isDisposed||(this._isDisposed=!0,this.ystate.unobserve(this.onStateChanged),this.awareness.destroy(),this.undoManager.destroy(),this.ydoc.destroy(),n.Signal.clearData(this))}getState(e){const t=this.ystate.get(e);return void 0===t?t:a.JSONExt.deepCopy(t)}setState(e,t){a.JSONExt.deepEqual(this.ystate.get(e),t)||this.ystate.set(e,t)}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}transact(e,t=!0){this.ydoc.transact(e,t?this:null)}}class r extends d{constructor(){super(),this.ysource=this.ydoc.getText("source"),this._modelObserver=e=>{this._changed.emit({sourceChange:e.changes.delta})},this.undoManager.addToScope(this.ysource),this.ysource.observe(this._modelObserver)}get source(){return this.getSource()}set source(e){this.setSource(e)}dispose(){this.isDisposed||(this.ysource.unobserve(this._modelObserver),super.dispose())}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{const t=this.ysource;t.delete(0,t.length),t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s),a.delete(e+s.length,t-e)}))}}const l=(e,t={})=>{switch(e.get("cell_type")){case"code":return new g(e,e.get("source"),e.get("outputs"),t);case"markdown":return new m(e,e.get("source"),t);case"raw":return new y(e,e.get("source"),t);default:throw new Error("Found unknown cell type")}},h=(e,t)=>{var s,n;const o=new i.Map,d=new i.Text;let r;switch(o.set("source",d),o.set("metadata",{}),o.set("cell_type",e.cell_type),o.set("id",null!==(s=e.id)&&void 0!==s?s:a.UUID.uuid4()),e.cell_type){case"markdown":r=new m(o,d,{notebook:t}),null!=e.attachments&&r.setAttachments(e.attachments);break;case"code":{const s=new i.Array;o.set("outputs",s),r=new g(o,d,s,{notebook:t});const a=e;r.execution_count=null!==(n=a.execution_count)&&void 0!==n?n:null,a.outputs&&r.setOutputs(a.outputs);break}default:r=new y(o,d,{notebook:t}),e.attachments&&r.setAttachments(e.attachments)}return null!=e.metadata&&r.setMetadata(e.metadata),null!=e.source&&r.setSource("string"==typeof e.source?e.source:e.source.join("\n")),r},u=e=>h(e);class c{static createStandalone(e){return h({id:e,cell_type:this.prototype.cell_type})}constructor(e,t,s={}){if(this._modelObserver=e=>{this._changed.emit(this.getChanges(e))},this._metadataChanged=new n.Signal(this),this._notebook=null,this._changed=new n.Signal(this),this._disposed=new n.Signal(this),this._isDisposed=!1,this._undoManager=null,this.ymodel=e,this._ysource=t,this._prevSourceLength=t?t.length:0,this._notebook=null,this._awareness=null,this._undoManager=null,s.notebook)this._notebook=s.notebook;else{const e=new i.Doc;e.getArray().insert(0,[this.ymodel]),this._awareness=new o.ww(e),this._undoManager=new i.UndoManager([this.ymodel],{trackedOrigins:new Set([this])})}this.ymodel.observeDeep(this._modelObserver)}get awareness(){var e,t,s;return null!==(s=null!==(e=this._awareness)&&void 0!==e?e:null===(t=this.notebook)||void 0===t?void 0:t.awareness)&&void 0!==s?s:null}get cell_type(){throw new Error("A YBaseCell must not be constructed")}get changed(){return this._changed}get disposed(){return this._disposed}get id(){return this.getId()}get isDisposed(){return this._isDisposed}get isStandalone(){return null!==this._notebook}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get notebook(){return this._notebook}get source(){return this.getSource()}set source(e){this.setSource(e)}get undoManager(){var e;return this.notebook?(null===(e=this.notebook)||void 0===e?void 0:e.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager:this._undoManager}setUndoManager(){if(this._undoManager)throw new Error("The cell undo manager is already set.");this._notebook&&this._notebook.disableDocumentWideUndoRedo&&(this._undoManager=new i.UndoManager([this.ymodel],{trackedOrigins:new Set([this])}))}get ysource(){return this._ysource}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var e;null===(e=this.undoManager)||void 0===e||e.clear()}undo(){var e;null===(e=this.undoManager)||void 0===e||e.undo()}redo(){var e;null===(e=this.undoManager)||void 0===e||e.redo()}dispose(){var e;if(!this._isDisposed){if(this._isDisposed=!0,this.ymodel.unobserveDeep(this._modelObserver),this._awareness){const e=this._awareness.doc;this._awareness.destroy(),e.destroy()}this._undoManager&&(this._undoManager===(null===(e=this.notebook)||void 0===e?void 0:e.undoManager)?this._undoManager=null:this._undoManager.destroy()),this._disposed.emit(),n.Signal.clearData(this)}}getId(){return this.ymodel.get("id")}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{this.ysource.delete(0,this.ysource.length),this.ysource.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s),a.delete(e+s.length,t-e)}))}deleteMetadata(e){if(void 0===this.getMetadata(e))return;const t=a.JSONExt.deepCopy(this.ymodel.get("metadata"));delete t[e],"collapsed"===e&&t.jupyter?(delete t.jupyter.outputs_hidden,0===Object.keys(t.jupyter).length&&delete t.jupyter):"jupyter"===e&&delete t.collapsed,this.setMetadata(t)}getMetadata(e){var t;const s=null!==(t=this.ymodel.get("metadata"))&&void 0!==t?t:{};return"string"==typeof e?void 0===s[e]?void 0:a.JSONExt.deepCopy(s[e]):a.JSONExt.deepCopy(s)}setMetadata(e,t){var s,n,o;if("string"==typeof e){if(void 0===t)throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`);const o=e;if(a.JSONExt.deepEqual(null!==(s=this.getMetadata(o))&&void 0!==s?s:null,t))return;const i=this.getMetadata();i[o]=t,"collapsed"===o&&(null===(n=i.jupyter)||void 0===n?void 0:n.outputs_hidden)!==t?i.jupyter={...i.jupyter,outputs_hidden:t}:"jupyter"===o&&(void 0!==t.outputs_hidden?i.collapsed!==t.outputs_hidden&&(i.collapsed=t.outputs_hidden):delete i.collapsed),this.transact((()=>{this.ymodel.set("metadata",i)}),!1)}else{const t=a.JSONExt.deepCopy(e);null!=t.collapsed?(t.jupyter=t.jupyter||{},t.jupyter.outputs_hidden=t.collapsed):null!=(null===(o=null==t?void 0:t.jupyter)||void 0===o?void 0:o.outputs_hidden)&&(t.collapsed=t.jupyter.outputs_hidden),a.JSONExt.deepEqual(t,this.getMetadata())||this.transact((()=>{this.ymodel.set("metadata",t)}),!1)}}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}transact(e,t=!0){!this.notebook||this.notebook.disableDocumentWideUndoRedo?null==this.ymodel.doc?e():this.ymodel.doc.transact(e,t?this:null):this.notebook.transact(e,t)}getChanges(e){var t;const s={},n=e.find((e=>e.target===this.ymodel.get("source")));n&&(s.sourceChange=n.changes.delta);const o=e.find((e=>e.target===this.ymodel));if(o&&o.keysChanged.has("metadata")){const e=o.changes.keys.get("metadata"),n=s.metadataChange={oldValue:(null==e?void 0:e.oldValue)?e.oldValue:void 0,newValue:this.getMetadata()},i=null!==(t=n.oldValue)&&void 0!==t?t:{},d=Object.keys(i),r=Object.keys(n.newValue);for(let e of new Set(d.concat(r)))d.includes(e)?r.includes(e)?a.JSONExt.deepEqual(i[e],n.newValue[e])||this._metadataChanged.emit({key:e,newValue:n.newValue[e],oldValue:n.oldValue[e],type:"change"}):this._metadataChanged.emit({key:e,oldValue:n.oldValue[e],type:"remove"}):this._metadataChanged.emit({key:e,newValue:n.newValue[e],type:"add"})}const i=this.ymodel.get("source");return o&&o.keysChanged.has("source")&&(s.sourceChange=[{delete:this._prevSourceLength},{insert:i.toString()}]),this._prevSourceLength=i.length,s}}class g extends c{static createStandalone(e){return super.createStandalone(e)}constructor(e,t,s,a={}){super(e,t,a),this._youtputs=s}get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")||null}set execution_count(e){this.ymodel.get("execution_count")!==e&&this.transact((()=>{this.ymodel.set("execution_count",e)}),!1)}get outputs(){return this.getOutputs()}set outputs(e){this.setOutputs(e)}getOutputs(){return a.JSONExt.deepCopy(this._youtputs.toArray())}setOutputs(e){this.transact((()=>{this._youtputs.delete(0,this._youtputs.length),this._youtputs.insert(0,e)}),!1)}updateOutputs(e,t,s=[]){const a=t<this._youtputs.length?t-e:this._youtputs.length-e;this.transact((()=>{this._youtputs.delete(e,a),this._youtputs.insert(e,s)}),!1)}toJSON(){return{...super.toJSON(),outputs:this.getOutputs(),execution_count:this.execution_count}}getChanges(e){const t=super.getChanges(e),s=e.find((e=>e.target===this.ymodel.get("outputs")));s&&(t.outputsChange=s.changes.delta);const a=e.find((e=>e.target===this.ymodel));if(a&&a.keysChanged.has("execution_count")){const e=a.changes.keys.get("execution_count");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("execution_count")}}return t}}class p extends c{get attachments(){return this.getAttachments()}set attachments(e){this.setAttachments(e)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(e){this.transact((()=>{null==e?this.ymodel.delete("attachments"):this.ymodel.set("attachments",e)}),!1)}getChanges(e){const t=super.getChanges(e),s=e.find((e=>e.target===this.ymodel));if(s&&s.keysChanged.has("attachments")){const e=s.changes.keys.get("attachments");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("attachments")}}return t}}class y extends p{static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class m extends p{static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class _ extends d{constructor(e={}){var t;super(),this.ymeta=this.ydoc.getMap("meta"),this._onMetaChanged=e=>{var t;if(e.keysChanged.has("metadata")){const s=e.changes.keys.get("metadata"),n={oldValue:(null==s?void 0:s.oldValue)?s.oldValue:void 0,newValue:this.getMetadata()},o=null!==(t=n.oldValue)&&void 0!==t?t:{},i=Object.keys(o),d=Object.keys(n.newValue);for(let e of new Set(i.concat(d)))i.includes(e)?d.includes(e)?a.JSONExt.deepEqual(o[e],n.newValue[e])||this._metadataChanged.emit({key:e,newValue:n.newValue[e],oldValue:n.oldValue[e],type:"change"}):this._metadataChanged.emit({key:e,oldValue:n.oldValue[e],type:"remove"}):this._metadataChanged.emit({key:e,newValue:n.newValue[e],type:"add"});this._changed.emit({metadataChange:n})}if(e.keysChanged.has("nbformat")){const t=e.changes.keys.get("nbformat"),s={key:"nbformat",oldValue:(null==t?void 0:t.oldValue)?t.oldValue:void 0,newValue:this.nbformat};this._changed.emit({nbformatChanged:s})}if(e.keysChanged.has("nbformat_minor")){const t=e.changes.keys.get("nbformat_minor"),s={key:"nbformat_minor",oldValue:(null==t?void 0:t.oldValue)?t.oldValue:void 0,newValue:this.nbformat_minor};this._changed.emit({nbformatChanged:s})}},this._onYCellsChanged=e=>{e.changes.added.forEach((e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){const e=l(t,{notebook:this});e.setUndoManager(),this._ycellMapping.set(t,e)}})),e.changes.deleted.forEach((e=>{const t=e.content.type,s=this._ycellMapping.get(t);s&&(s.dispose(),this._ycellMapping.delete(t))}));let t=0;const s=[];e.changes.delta.forEach((e=>{if(null!=e.insert){const a=e.insert.map((e=>this._ycellMapping.get(e)));s.push({insert:a}),this.cells.splice(t,0,...a),t+=e.insert.length}else null!=e.delete?(s.push(e),this.cells.splice(t,e.delete)):null!=e.retain&&(s.push(e),t+=e.retain)})),this._changed.emit({cellsChange:s})},this._metadataChanged=new n.Signal(this),this._ycells=this.ydoc.getArray("cells"),this._ycellMapping=new WeakMap,this._disableDocumentWideUndoRedo=null!==(t=e.disableDocumentWideUndoRedo)&&void 0!==t&&t,this.cells=this._ycells.toArray().map((e=>(this._ycellMapping.has(e)||this._ycellMapping.set(e,l(e,{notebook:this})),this._ycellMapping.get(e)))),this.undoManager.addToScope(this._ycells),this._ycells.observe(this._onYCellsChanged),this.ymeta.observe(this._onMetaChanged)}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get nbformat(){return this.ymeta.get("nbformat")}set nbformat(e){this.transact((()=>{this.ymeta.set("nbformat",e)}),!1)}get nbformat_minor(){return this.ymeta.get("nbformat_minor")}set nbformat_minor(e){this.transact((()=>{this.ymeta.set("nbformat_minor",e)}),!1)}dispose(){this.isDisposed||(this._ycells.unobserve(this._onYCellsChanged),this.ymeta.unobserve(this._onMetaChanged),super.dispose())}getCell(e){return this.cells[e]}addCell(e){return this.insertCell(this._ycells.length,e)}insertCell(e,t){return this.insertCells(e,[t])[0]}insertCells(e,t){const s=t.map((e=>{const t=h(e,this);return this._ycellMapping.set(t.ymodel,t),t}));return this.transact((()=>{this._ycells.insert(e,s.map((e=>e.ymodel)))})),s.forEach((e=>{e.setUndoManager()})),s}moveCell(e,t){this.moveCells(e,t)}moveCells(e,t,s=1){const a=new Array(s).fill(!0).map(((t,s)=>this.getCell(e+s).toJSON()));this.transact((()=>{this._ycells.delete(e,s),this._ycells.insert(e>t?t:t-s+1,a.map((e=>h(e,this).ymodel)))}))}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact((()=>{this._ycells.delete(e,t-e)}))}deleteMetadata(e){if(void 0===this.getMetadata(e))return;const t=a.JSONExt.deepCopy(this.ymeta.get("metadata"));delete t[e],this.setMetadata(t)}getMetadata(e){var t;const s=null!==(t=this.ymeta.get("metadata"))&&void 0!==t?t:{};return"string"==typeof e?void 0===s[e]?void 0:a.JSONExt.deepCopy(s[e]):a.JSONExt.deepCopy(s)}setMetadata(e,t){var s;if("string"==typeof e){if(void 0===t)throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`);if(a.JSONExt.deepEqual(null!==(s=this.getMetadata(e))&&void 0!==s?s:null,t))return;const n={};n[e]=t,this.updateMetadata(n)}else a.JSONExt.deepEqual(this.metadata,e)||this.ymeta.set("metadata",a.JSONExt.deepCopy(e))}updateMetadata(e){this.ymeta.set("metadata",{...this.getMetadata(),...e})}fromJSON(e){this.transact((()=>{this.nbformat=e.nbformat,this.nbformat_minor=e.nbformat_minor;const t=e.metadata;void 0!==t.orig_nbformat&&delete t.orig_nbformat,this.metadata=t;const s=4===e.nbformat&&e.nbformat_minor>=5,a=e.cells.map((e=>(s||delete e.id,e)));this.insertCells(this.cells.length,a),this.deleteCellRange(0,this.cells.length)}))}toJSON(){const e=4===this.nbformat&&this.nbformat_minor<=4;return{metadata:this.metadata,nbformat_minor:this.nbformat_minor,nbformat:this.nbformat,cells:this.cells.map((t=>{const s=t.toJSON();return e&&delete s.id,s}))}}}function b(e){let t=new Map;return e.changes.keys.forEach(((e,s)=>{t.set(s,{action:e.action,oldValue:e.oldValue,newValue:this.ymeta.get(s)})})),t}const C=()=>{let e=!0;return t=>{if(e){e=!1;try{t()}finally{e=!0}}}}}}]);