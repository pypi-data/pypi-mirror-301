# SPDX-FileCopyrightText: 2024 OpenBit
#
# SPDX-License-Identifier: CC0-1.0

# NB: We run git clone instead of the checkout action
# until the action supports SHA256
# https://github.com/actions/checkout/issues/1843
on: [push]
jobs:
  pylint:
    runs-on: docker
    container:
      image: python:alpine
    steps:
      - run: apk --update add git
      - run: |
          git clone ${{ env.GITHUB_SERVER_URL }}/${{ env.GITHUB_REPOSITORY }} ${{ env.GITHUB_WORKSPACE }}
          git -C ${{ env.GITHUB_WORKSPACE }} checkout ${{ env.GITHUB_SHA }}
      - run: python -m pip install pylint
      - run: python -m pylint src/
  flake8:
    runs-on: docker
    container:
      image: python:alpine
    steps:
      - run: apk --update add git
      - run: |
          git clone ${{ env.GITHUB_SERVER_URL }}/${{ env.GITHUB_REPOSITORY }} ${{ env.GITHUB_WORKSPACE }}
          git -C ${{ env.GITHUB_WORKSPACE }} checkout ${{ env.GITHUB_SHA }}
      - run: python -m pip install flake8
      - run: python -m flake8 src/
  vermin:
    runs-on: docker
    container:
      image: python:alpine
    steps:
      - run: apk --update add git
      - run: |
          git clone ${{ env.GITHUB_SERVER_URL }}/${{ env.GITHUB_REPOSITORY }} ${{ env.GITHUB_WORKSPACE }}
          git -C ${{ env.GITHUB_WORKSPACE }} checkout ${{ env.GITHUB_SHA }}
      - run: python -m pip install vermin
      - run: vermin --no-backport --no-parse-comments --pessimistic --no-tips --target=3.10- src/
  reuse:
    runs-on: docker
    container:
      image: fsfe/reuse
    steps:
      - run: apk --update add git
      - run: |
          git clone ${{ env.GITHUB_SERVER_URL }}/${{ env.GITHUB_REPOSITORY }} ${{ env.GITHUB_WORKSPACE }}
          git -C ${{ env.GITHUB_WORKSPACE }} checkout ${{ env.GITHUB_SHA }}
      - run: reuse lint
