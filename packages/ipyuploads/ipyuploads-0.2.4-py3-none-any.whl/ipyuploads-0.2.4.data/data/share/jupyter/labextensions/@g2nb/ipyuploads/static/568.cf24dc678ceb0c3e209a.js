(self.webpackChunk_g2nb_ipyuploads=self.webpackChunk_g2nb_ipyuploads||[]).push([[568],{568:(e,t,s)=>{e.exports=s(105),e.exports.version=s(147).version},105:(e,t,s)=>{"use strict";s.r(t),s.d(t,{UploadModel:()=>n,UploadView:()=>o});const i=s(985),l=(s(431),s(147));class n extends i.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"UploadModel",_model_module:l.name,_model_module_version:l.version,_view_name:"UploadView",_view_module:l.name,_view_module_version:l.version,accept:"",description:"Upload",disabled:!1,icon:"upload",button_style:"",multiple:!1,value:[],error:"",style:null,busy:!1}}}class o extends i.DOMWidgetView{preinitialize(){this.tagName="button",this.class_map={primary:["mod-primary"],success:["mod-success"],info:["mod-info"],warning:["mod-warning"],danger:["mod-danger"]},this._icon=null,this._description=null,this._chunks_total=0,this._chunks_complete=0}render(){this.el.classList.add("jupyter-widgets","widget-upload","jupyter-button"),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.style.display="none",this.el.addEventListener("click",(()=>this.fileInput.click())),this.fileInput.addEventListener("click",(()=>this.fileInput.value="")),this.fileInput.addEventListener("change",(()=>this.upload_files())),this.listenTo(this.model,"change:button_style",this.update_button_style),this.set_button_style(),this.update()}update_upload_label(e,t){if(e&&(this._icon=this.model.get("icon"),this._description=this.model.get("description"),this.model.set("icon","")),t)this.model.set("icon",this._icon),this.model.set("description",this._description);else{const e=Math.floor(this._chunks_complete*(100/this._chunks_total));this.model.set("description",`${e}%`)}this.model.save()}encode_chunk(e){return new Promise(((t,s)=>{const i=new FileReader;i.onloadend=()=>t(i.result.split(",")[1]),i.readAsDataURL(e)}))}async chunk_file(e){const t=1048576,s=Math.ceil(e.size/t),i=[],l=[];let n=0;for(;n<s;){let s=n*t,i=e.slice(s,s+t);l.push(i),n++}n=0;for(const t of l){const l=await this.encode_chunk(t),o=async()=>(this.send({event:"upload",file:e.name,count:n+1,total:s,chunk:l}),n++,this._chunks_complete++,this.update_upload_label(!1,!1),{chunk:this._chunks_complete,total:this._chunks_total});i.push(o)}return i}async upload_files(){this.model.set("busy",!0),this.model.save(),this._chunks_total=0,this._chunks_complete=0;const e=Array.from(this.fileInput.files??[]);e.forEach((e=>this._chunks_total+=Math.ceil(e.size/1048576))),this.update_upload_label(!0,!1);const t=[];e.forEach((e=>{t.push((async()=>{const t=await this.chunk_file(e);for(const e of t)await e();return this.send({event:"file_complete",name:e.name}),{name:e.name,type:e.type,size:e.size,last_modified:e.lastModified}}))}));const s=[];for(const e of t)s.push(await e());this.model.set("busy",!1),this.model.set({value:s,error:""}),this.update_upload_label(!1,!0),this.send({event:"all_files_complete",names:s})}update(){this.el.disabled=this.model.get("disabled"),this.el.setAttribute("title",this.model.get("tooltip")),this.fileInput.accept=this.model.get("accept"),this.fileInput.multiple=this.model.get("multiple");const e=this.model.get("description"),t=this.model.get("icon");if(e.length||t.length){if(this.el.textContent="",t.length){const s=document.createElement("i");s.classList.add("fa","fa-"+t),0===e.length&&s.classList.add("center"),this.el.appendChild(s)}this.el.appendChild(document.createTextNode(e))}}update_button_style(){this.update_mapped_classes(this.class_map,"button_style",this.el)}set_button_style(){this.set_mapped_classes(this.class_map,"button_style",this.el)}}},147:e=>{"use strict";e.exports=JSON.parse('{"name":"@g2nb/ipyuploads","version":"0.2.4","description":"A Jupyter file widget with chunked upload capabilities","author":{"name":"Thorin Tabor","email":"tmtabor@cloud.ucsd.edu"},"license":"BSD-3-Clause","main":"lib/index.js","homepage":"https://github.com/g2nb/ipyuploads","repository":{"type":"git","url":"https://github.com/g2nb/ipyuploads.git"},"bugs":{"url":"https://github.com/g2nb/ipyuploads/issues"},"keywords":["jupyter","widgets","ipython","ipywidgets","jupyterlab-extension"],"files":["lib/**/*.js","dist/*.js"],"scripts":{"clean":"rimraf dist/ && rimraf ../ipyuploads/labextension/ && rimraf ../ipyuploads/nbextension","prepublish":"yarn run clean && yarn run build:prod","build":"webpack --mode=development && yarn run build:labextension:dev","build:prod":"webpack --mode=production && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","watch":"webpack --watch --mode=development","test":"echo \\"Error: no test specified\\" && exit 1"},"devDependencies":{"@jupyterlab/builder":"^3.0.0","webpack":"^5","rimraf":"^2.6.1"},"dependencies":{"@jupyter-widgets/base":"^6","lodash":"^4.17.4"},"jupyterlab":{"extension":"lib/labplugin","outputDir":"../ipyuploads/labextension","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);